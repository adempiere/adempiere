apply plugin: 'java'

description = 'Add description for tools project'
version = '4.0.0-SNAPSHOT'


def libDir = '../lib'
def jbossClientLibDir = '../jboss/client'
def glassfishLibDir = '../glassfishfacet/lib'

def archiveSpecifier = '-' + version + '.jar'

dependencies {
    compile fileTree(dir: libDir, include: '*.jar')
}


jar {
    manifest {
        attributes("Implementation-Title": "ADempiere Tools - Rel." + version,
                "Implementation-Version": version,
                "Implementation-Vendor": "ADempiere",
                "Implementation-URL": "http://www.adempiere.org",
                "Main-Class": "org.compiere.report.ReportStarter"
        )
    }
}

task prepareCSToolsJar(type: Copy) {

    destinationDir = new File('build/tmp/cstools')

    FileTree ft1 = fileTree(dir: '../lib/server')

    ft1.each { File it1 ->

        exclude 'META-INF/*.DSA'
        exclude 'META-INF/*.RSA'
        exclude 'META-INF/*.SF'
        exclude 'META-INF/MANIFEST.MF'
        exclude 'META-INF/INDEX.LIST'

        from zipTree(it1)
        into destinationDir
    }


    FileTree ft2 = fileTree(dir: '.', include: 'META-INF/services/**')

    from {
        ft2.each { it2 ->
            it2.isDirectory() ? it2 : zipTree(it2)
        }
    }

    FileTree ft3 = fileTree(dir: './build/classes/main', include: '**/apache/ecs/**')

    from {
        ft3.each { it3 ->
            it3.isDirectory() ? it3 : zipTree(it3)
        }
    }
}

task buildCSToolsJar(type: Jar) {

    FileTree ft1 = fileTree(dir: 'build/tmp/cstools')

    from {
        ft1.each { it1 ->
            it1.isDirectory() ? it1 : zipTree(it1)
        }
    }

    archiveName = 'CSTools' + archiveSpecifier

    manifest {
        attributes("Implementation-Title": "Adempiere Server Tools (CSTOOLS) - " + version,
                "Implementation-Version": version,
                "Implementation-Vendor": "ADempiere",
                "Implementation-URL": "http://www.adempiere.org"
        )
    }
}

task buildJBossJar(type: Jar) {

    FileCollection fc = files([jbossClientLibDir + '/jboss-ejb3x.jar',
                               jbossClientLibDir + '/jboss-ejb3-client.jar',
                               jbossClientLibDir + '/jbossall-client.jar'
    ])

    archiveName = 'jboss' + archiveSpecifier

    manifest {
        attributes("Implementation-Title": "Adempiere JBoss Client - " + version,
                "Implementation-Version": version,
                "Implementation-Vendor": "ADempiere",
                "Implementation-URL": "http://www.adempiere.org"
        )
    }

    from {
        fc.collect {
            it.isDirectory() ? it : zipTree(it)
        }
    } {
        exclude 'META-INF/*'
    }

}

task buildGlassfishJar(type: Jar) {

    FileCollection fc = files([glassfishLibDir + '/appserv-admin.jar',
                               glassfishLibDir + '/appserv-deployment-client.jar',
                               glassfishLibDir + '/appserv-rt.jar',
                               glassfishLibDir + '/appserv-ext.jar',
                               libDir + '/javaee.jar'
    ])

    from {
        fc.collect {
            it.isDirectory() ? it : zipTree(it)
        }
    } {
        exclude 'META-INF/*'
    }

    archiveName = 'glassfish' + archiveSpecifier

    manifest {
        attributes("Implementation-Title": "Adempiere GlassFish Client - " + version,
                "Implementation-Version": version,
                "Implementation-Vendor": "ADempiere",
                "Implementation-URL": "http://www.adempiere.org"
        )
    }
}


task buildOracleJar(type: Jar) {

    FileCollection fc = files([libDir + '/ojdbc6.jar'
    ])

    from {
        fc.collect {
            it.isDirectory() ? it : zipTree(it)
        }
    } {
        exclude 'META-INF/*'
    }

    archiveName = 'oracle' + archiveSpecifier

    manifest {
        attributes("Implementation-Title": "Adempiere Oracle - " + version,
                "Implementation-Version": version,
                "Implementation-Vendor": "ADempiere",
                "Implementation-URL": "http://www.adempiere.org"
        )
    }
}

task buildPostgresqlJar(type: Jar) {

    FileCollection fc = files([libDir + '/postgresql.jar'
    ])

    from {
        fc.collect {
            it.isDirectory() ? it : zipTree(it)
        }
    } {
        exclude 'META-INF/*'
    }

    archiveName = 'postgresql' + archiveSpecifier

    manifest {
        attributes("Implementation-Title": "Adempiere PostgreSQL - " + version,
                "Implementation-Version": version,
                "Implementation-Vendor": "ADempiere",
                "Implementation-URL": "http://www.adempiere.org"
        )
    }
}

task buildMySQLJar(type: Jar) {

    FileCollection fc = files([
            libDir + '/mysql-connector-java-5.1.13-bin.jar'
    ])

    from {
        fc.collect {
            it.isDirectory() ? it : zipTree(it)
        }
    } {
        exclude 'META-INF/*'
    }

    archiveName = 'mysql-connector' + archiveSpecifier

    manifest {
        attributes("Implementation-Title": "Adempiere MySQL - " + version,
                "Implementation-Version": version,
                "Implementation-Vendor": "ADempiere",
                "Implementation-URL": "http://www.adempiere.org"
        )
    }
}
